<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Snow Day Predictor</title>

  <!-- Inter Variable -->
  <link
    rel="stylesheet"
    href="https://rsms.me/inter/inter.css"
  />

  <link rel="stylesheet" href="style.css?v=1.2.1" />

  <!-- Optional: better behavior with dark mode -->
  <meta name="theme-color" content="#1d1c1c">
</head>
<body>
  <main class="page">
    <header class="header">
      <h1 class="location">Owen Sound</h1>
      <h2 class="title">Snow Day Predictor.</h2>
      <p class="subtitle">Hoping for a snow day?</p>
    </header>

    <section class="card">
      <!-- Top -->
      <div class="current">
        <div class="current-percent">18%</div>
        <div class="current-label">Tomorrow</div>
      </div>

      <div class="reasons">
        <div class="reason" id="reason1">Test Reason 1</div>
        <div class="reason" id="reason2">Test Reason 2</div>
        <div class="reason" id="reason3">Test Reason 3</div>
      </div>

      <div class="others">
        <div class="others-amount">2,367 other are hoping for a snow day ðŸ”¥</div>
      </div>

      <div>
        <section class="line">
        </section>
      </div>

      <div>
        <div class ="forecast-label">Upcoming Weekdays</div>
      </div>

      <!-- Bottom -->
      <div class="metrics">
        <div class="metric">
          <div class="metric-value">22%</div>
          <div class="metric-label">Tuesday</div>
        </div>
        <div class="metric">
          <div class="metric-value">18%</div>
          <div class="metric-label">Wednesday</div>
        </div>
        <div class="metric">
          <div class="metric-value">5%</div>
          <div class="metric-label">Thursday</div>
        </div>
        <div class="metric">
          <div class="metric-value">67%</div>
          <div class="metric-label">Friday</div>
        </div>
      </div>

      <div>
        <div class="disclaimer">*Long-range predictions may be inaccurate.</div>
      </div>
    </section>
    <section class="card">
      <div>
        <div class ="upcoming-updates-label">Next Update</div>
        <div class="upcoming-updates-content">
           â€¢ Improved prediction accuracy, taking into account weather warnings issued by the Government of Canada.
          <br />
          â€¢ Prediction explanations to help you understand why a snow day is more or less likely, replaceing the placeholder reasons above.
        </div>
      </div>
    </section>
  </main>
  <footer class="footer">
      <div class="footer-inner">
        <h2 class="footer-title">Support â€¢ Feedback â€¢ Suggestions â€¢ Questions</h2>

        <textarea
          class="suggest-box"
          id="feedbackBox"
          placeholder="Type your message hereâ€¦"
        ></textarea>

        <button class="suggest-btn" id="submitFeedback">
          Submit
        </button>

        <p class="submit-status" id="submitStatus"></p>

      </div>
    </footer>

<script>
  function updateProbabilities(list) {
    document.querySelector(".current-percent").textContent =
      list[0].snow_day_probability + "%";
    document.querySelector(".current-label").textContent =
      list[0].weekday;

    const metricValues = document.querySelectorAll(".metric-value");
    const metricLabels = document.querySelectorAll(".metric-label");

    for (let i = 1; i < list.length; i++) {
      metricValues[i - 1].textContent = list[i].snow_day_probability + "%";
      metricLabels[i - 1].textContent = list[i].weekday;
    }
  }

  const results = JSON.parse(`{{ data | tojson | safe }}`);
  updateProbabilities(results);
</script>

<script>
  function updateOthers(value) {
    document.querySelector(".others-amount").textContent =
      value + " others are hoping for a snow day ðŸ”¥";
  }

  const value = Number(`{{ counter_value }}`);
  updateOthers(value);
</script>

<script>
  const button = document.getElementById("submitFeedback");
  const box = document.getElementById("feedbackBox");
  const statusMsg = document.getElementById("submitStatus");

  button.addEventListener("click", async () => {
    const content = box.value.trim();

    if (!content) {
      box.focus();
      return;
    }

    button.disabled = true;

    try {
      await fetch("https://discord.com/api/webhooks/1455940293374251171/usYpb_FqdvLcCxJkfFnKSCKPbvSTGpEhSYcrCfHurV43IIwArVN7xRjQo70csIgkPDy0", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          content: `ðŸ“© New feedback:\n \n ${content}`
        })
      });

      statusMsg.textContent = "Submitted â€” thank you!";
      box.value = "";

    } catch (err) {
      statusMsg.textContent = "Submission failed. Try again later.";
    }

    button.disabled = false;
  });
</script>

</body>
</html>